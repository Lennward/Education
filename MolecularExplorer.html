<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cell & Protein Analytics Interactive Course</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            /* Removed fixed height to allow content to define height */
            /* display: flex; flex-direction: column; are not needed here as .flex.h-screen handles it */
        }
        .sidebar-link {
            transition: all 0.3s ease;
        }
        .sidebar-link:hover, .sidebar-link.active {
            background-color: #4a5568; /* gray-700 */
            color: #facc15; /* yellow-400 */
            transform: translateX(5px);
        }
        .module-content h2 {
            font-size: 1.75rem; /* 28px */
            font-weight: 600; /* semibold */
            color: #1e3a8a; /* blue-800 */
            margin-bottom: 1rem;
            border-bottom: 2px solid #3b82f6; /* blue-500 */
            padding-bottom: 0.5rem;
        }
        .module-content h3 {
            font-size: 1.25rem; /* 20px */
            font-weight: 600; /* semibold */
            color: #1d4ed8; /* blue-700 */
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
        }
        .module-content p, .module-content ul, .module-content ol, .module-content table {
            margin-bottom: 1rem;
            line-height: 1.6;
            color: #374151; /* gray-700 */
        }
        .module-content ul, .module-content ol {
            list-style-type: disc;
            margin-left: 1.5rem;
        }
        .module-content ol.list-decimal {
            list-style-type: decimal;
        }
        .module-content .formula {
            font-family: 'Times New Roman', Times, serif;
            font-size: 1.1em;
            color: #1e40af; /* blue-800 */
            background-color: #f0f9ff; /* blue-50 */
            padding: 0.5rem 1rem;
            border-radius: 0.375rem; /* rounded-md */
            border: 1px solid #e0f2fe; /* blue-100 */
            display: inline-block;
            margin-top: 0.25rem;
            margin-bottom: 0.75rem;
        }
        .interactive-box, .practice-problem-box {
            background-color: #eff6ff; /* blue-50 */
            border: 1px solid #bfdbfe; /* blue-200 */
            border-radius: 0.5rem; /* rounded-lg */
            padding: 1.5rem;
            margin-top: 1.5rem;
            margin-bottom: 1.5rem;
        }
        .interactive-box h4, .practice-problem-box h4 {
            font-size: 1.1rem;
            font-weight: 600;
            color: #1e40af; /* blue-800 */
            margin-bottom: 1rem;
        }
        .quiz-question {
            background-color: #f9fafb; /* gray-50 */
            border: 1px solid #e5e7eb; /* gray-200 */
            border-radius: 0.5rem; /* rounded-lg */
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        .quiz-option {
            display: block;
            width: 100%;
            background-color: #fff;
            border: 1px solid #d1d5db; /* gray-300 */
            border-radius: 0.375rem; /* rounded-md */
            padding: 0.75rem 1rem;
            margin-bottom: 0.5rem;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: left;
        }
        .quiz-option:hover {
            border-color: #3b82f6; /* blue-500 */
            background-color: #eff6ff; /* blue-50 */
        }
        .quiz-option.correct, .practice-problem-box .correct-answer {
            background-color: #d1fae5 !important; /* green-100 */
            border-color: #10b981 !important; /* green-500 */
            color: #065f46 !important; /* green-800 */
        }
        .quiz-option.incorrect, .practice-problem-box .incorrect-answer {
            background-color: #fee2e2 !important; /* red-100 */
            border-color: #ef4444 !important; /* red-500 */
            color: #991b1b !important; /* red-800 */
        }
        .feedback-message, .practice-feedback {
            margin-top: 0.5rem;
            font-weight: 500;
        }
        .calculator input, .calculator select, .practice-problem-box input {
            border: 1px solid #d1d5db; /* gray-300 */
            border-radius: 0.375rem; /* rounded-md */
            padding: 0.5rem 0.75rem;
            margin-right: 0.5rem;
            margin-bottom: 0.5rem;
            box-sizing: border-box;
        }
        .calculator button, .practice-problem-box button {
            background-color: #3b82f6; /* blue-500 */
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem; /* rounded-md */
            transition: background-color 0.2s ease;
            border: none;
        }
        .calculator button:hover, .practice-problem-box button:hover {
            background-color: #2563eb; /* blue-600 */
        }
        /* Ensure flex container takes full viewport height */
        .flex.h-screen {
            display: flex;
            height: 100vh;
        }
        /* Allow sidebar to shrink but not grow, and enable scrolling if content overflows */
        #sidebar {
            flex-shrink: 0;
            overflow-y: auto; /* Added for scrolling if sidebar content is too long */
        }
        /* Allow main content to grow and enable scrolling */
        #main-content {
            flex-grow: 1;
            overflow-y: auto; /* This is crucial for scrolling main content */
        }
        .solution-details {
            font-size: 0.9rem;
            color: #4b5563; /* gray-600 */
            background-color: #f9fafb; /* gray-50 */
            border-left: 3px solid #3b82f6; /* blue-500 */
            padding: 0.75rem;
            margin-top: 0.75rem;
            border-radius: 0.25rem; /* rounded-sm */
        }

        .plasmid-info-box, .media-component-info-box { /* General styling for these info boxes */
            padding: 0.75rem;
            border-radius: 0.375rem; /* rounded-md */
            margin-top: 0.75rem;
            font-size: 0.9rem;
        }

        .media-component-button { /* Specific to Module 1 Media Prep */
            background-color: #93c5fd; /* blue-300 */
            border: 1px solid #60a5fa; /* blue-400 */
        }
        .media-component-button:hover {
            background-color: #60a5fa; /* blue-400 */
        }
        .media-component-button.selected {
            background-color: #3b82f6; /* blue-500 */
            color: white;
            font-weight: bold;
        }
    </style>
</head>
<body class="bg-gray-200">

    <div class="flex h-screen font-inter">
        <nav id="sidebar" class="w-64 sm:w-72 bg-slate-800 text-slate-100 p-4 sm:p-6 space-y-3 shadow-lg">
            <h1 class="text-xl sm:text-2xl font-bold text-yellow-400 mb-6 border-b-2 border-yellow-500 pb-2">Molecular Explorer</h1>
            </nav>

        <main id="main-content" class="flex-1 p-4 sm:p-6 md:p-10 bg-slate-50">
            <div id="welcome-message" class="text-center p-6 sm:p-10 bg-white rounded-lg shadow-md">
                <h2 class="text-2xl sm:text-3xl font-semibold text-blue-700 mb-4">Welcome to the Interactive Cell & Protein Analytics Course!</h2>
                <p class="text-base sm:text-lg text-gray-600 mb-6">Select a module from the sidebar to begin your learning journey.</p>
                <img src="https://placehold.co/200x80/FFFFFF/000000?text=Heidelberg+Logo" alt="Heidelberg Logo Placeholder" class="block mx-auto h-16 w-auto">
                </div>
            </main>
    </div>

    <script>
        // --- DATA FOR MODULES ---
        const modulesData = [
            {
                id: "module1",
                title: "Module 1: Cell & Molecular Biology Fundamentals",
                content: () => `
                    <div class="module-content">
                        <h2>Module 1: Fundamentals of Cell & Molecular Biology & Cell Culture</h2>
                        
                        <h3>Part A: Core Biology</h3>
                        <h4>Prokaryotes vs. Eukaryotes</h4>
                        <p>Living organisms are made of cells. The two main types are:</p>
                        <ul>
                            <li><strong>Prokaryotes:</strong> Simple cells (e.g., bacteria) lacking a true nucleus. Their DNA is located in the cytoplasm.</li>
                            <li><strong>Eukaryotes:</strong> Complex cells (e.g., animal, plant, fungal cells) with a true nucleus enclosing the DNA, and various membrane-bound organelles like mitochondria and endoplasmic reticulum.</li>
                        </ul>

                        <h4>Plasmids</h4>
                        <p>A plasmid is a small, circular, double-stranded DNA molecule that is distinct from a cell's chromosomal DNA. Plasmids naturally exist in bacterial cells and they also occur in some eukaryotes. In the lab, scientists use plasmids to introduce new genes into cells.</p>
                        <p><strong>Key Components of a Lab Plasmid:</strong></p>
                        <div class="interactive-box">
                            <h4>Interactive: Plasmid Components</h4>
                            <p class="text-sm mb-2">Imagine a circular plasmid. Click on the names to learn about each part.</p>
                            <div id="plasmid-components-buttons" class="flex flex-wrap gap-2">
                                <button class="plasmid-component-btn bg-blue-500 hover:bg-blue-600 text-white py-1 px-3 rounded-full text-xs sm:text-sm" data-info="Origin of Replication (ori): The DNA sequence where replication of the plasmid begins, allowing it to be copied within the host cell.">Origin of Replication (ori)</button>
                                <button class="plasmid-component-btn bg-green-500 hover:bg-green-600 text-white py-1 px-3 rounded-full text-xs sm:text-sm" data-info="Promoter: A DNA sequence that initiates transcription of a particular gene. It's located near the transcription start sites of genes. E.g., CMV promoter for strong expression in mammalian cells.">Promoter</button>
                                <button class="plasmid-component-btn bg-red-500 hover:bg-red-600 text-white py-1 px-3 rounded-full text-xs sm:text-sm" data-info="Multiple Cloning Site (MCS) / Polylinker: A short segment of DNA which contains many (up to ~20) restriction enzyme sites - a standard feature of engineered plasmids. This allows easy insertion of your gene of interest using restriction enzymes.">Multiple Cloning Site (MCS)</button>
                                <button class="plasmid-component-btn bg-purple-500 hover:bg-purple-600 text-white py-1 px-3 rounded-full text-xs sm:text-sm" data-info="Gene of Interest: The specific gene that you want to study or express in the host cells (e.g., a gene coding for GFP, a therapeutic protein, or a regulatory RNA).">Gene of Interest</button>
                                <button class="plasmid-component-btn bg-yellow-500 hover:bg-yellow-600 text-black py-1 px-3 rounded-full text-xs sm:text-sm" data-info="Selection Marker: A gene that confers a trait suitable for artificial selection. For example, an antibiotic resistance gene (like Ampicillin or Kanamycin resistance) allows only cells that have successfully taken up the plasmid to grow in the presence of that antibiotic.">Selection Marker</button>
                                <button class="plasmid-component-btn bg-pink-500 hover:bg-pink-600 text-white py-1 px-3 rounded-full text-xs sm:text-sm" data-info="Tag (e.g., GFP, FLAG, His-tag): A short DNA sequence fused to the gene of interest that, when expressed, adds a peptide tag to the protein. This tag can be used for detection (e.g., GFP for fluorescence, FLAG for antibody detection) or purification (e.g., His-tag for affinity chromatography).">Tag (e.g., GFP, FLAG)</button>
                            </div>
                            <div id="plasmid-component-info" class="plasmid-info-box mt-3 p-3 rounded bg-blue-100 border border-blue-300 text-sm text-blue-800" style="display: none;">Select a component to see its description.</div>
                            <p class="mt-2 text-xs text-gray-600">Note: DNA is negatively charged due to its phosphate backbone.</p>
                        </div>

                        <h3>Part B: Cell Culture Deep Dive</h3>
                        <h4>Introduction to Cell Culture</h4>
                        <p>Cell culture is the process by which cells are grown under controlled conditions, generally outside their natural environment (<em>in vitro</em>). Cells can be grown as:</p>
                        <ul>
                            <li><strong>Adherent cultures:</strong> Cells grow attached to a surface (e.g., flask, plate).</li>
                            <li><strong>Suspension cultures:</strong> Cells float freely in the culture medium.</li>
                        </ul>

                        <h4>Primary Cultures vs. Cell Lines</h4>
                        <div class="overflow-x-auto">
                        <table class="w-full text-sm text-left text-gray-500 dark:text-gray-400 my-4 border">
                            <thead class="text-xs text-gray-700 uppercase bg-gray-200 dark:bg-gray-700 dark:text-gray-400">
                                <tr><th scope="col" class="px-4 py-2 sm:px-6 sm:py-3">Feature</th><th scope="col" class="px-4 py-2 sm:px-6 sm:py-3">Primary Cultures</th><th scope="col" class="px-4 py-2 sm:px-6 sm:py-3">Cell Lines</th></tr>
                            </thead>
                            <tbody>
                                <tr class="bg-white border-b"><td class="px-4 py-2 sm:px-6 sm:py-4">Origin</td><td class="px-4 py-2 sm:px-6 sm:py-4">Directly from tissues/organs</td><td class="px-4 py-2 sm:px-6 sm:py-4">Immortalized cells (e.g., tumor-derived, virally transformed)</td></tr>
                                <tr class="bg-gray-50 border-b"><td class="px-4 py-2 sm:px-6 sm:py-4">Lifespan</td><td class="px-4 py-2 sm:px-6 sm:py-4">Limited (finite)</td><td class="px-4 py-2 sm:px-6 sm:py-4">Unlimited (continuous)</td></tr>
                                <tr class="bg-white border-b"><td class="px-4 py-2 sm:px-6 sm:py-4">Properties</td><td class="px-4 py-2 sm:px-6 sm:py-4">More representative of in vivo state</td><td class="px-4 py-2 sm:px-6 sm:py-4">May have altered characteristics, easier to grow</td></tr>
                                <tr class="bg-gray-50"><td class="px-4 py-2 sm:px-6 sm:py-4">Examples</td><td class="px-4 py-2 sm:px-6 sm:py-4">Neurons, fibroblasts from biopsy</td><td class="px-4 py-2 sm:px-6 sm:py-4">HEK293, HeLa, CHO</td></tr>
                            </tbody>
                        </table>
                        </div>
                        <p><strong>HEK293 Cells:</strong> Human Embryonic Kidney cells, transformed with Adenovirus 5 DNA. They are adherent epithelial cells commonly used for their high transfection efficiency and protein production capabilities.</p>

                        <h4>Cell Culture Environment & Media</h4>
                        <p>Cells need a controlled environment:</p>
                        <ul>
                            <li><strong>Temperature:</strong> Typically 37&deg;C for mammalian cells.</li>
                            <li><strong>CO<sub>2</sub>:</strong> Usually 5% in the incubator to work with the NaHCO<sub>3</sub> buffer system in the medium to maintain physiological pH.</li>
                            <li><strong>Humidity:</strong> High (70-100%) to prevent evaporation of medium.</li>
                            <li><strong>Sterility:</strong> Essential to prevent contamination.</li>
                        </ul>
                        <p><strong>Culture Media:</strong> Provides nutrients for cell growth.</p>
                        <div class="interactive-box">
                            <h4>Interactive: Media Prep Station</h4>
                            <p class="text-sm mb-2">You are preparing complete DMEM. Click on each component you would add to the basal DMEM to learn more about it.</p>
                            <div id="media-components-list" class="my-2 space-y-1">
                                <button class="media-component-button block w-full text-left p-2 rounded hover:bg-blue-200 text-xs sm:text-sm" data-info="Basal DMEM (Dulbecco's Modified Eagle's Medium): Contains a mixture of inorganic salts (for osmotic balance and membrane potential), L-amino acids (building blocks for proteins), vitamins (cofactors for enzymes), D-glucose (energy source), and often sodium pyruvate (additional energy source). This is the foundation of your complete medium.">1. Basal DMEM (salts, amino acids, vitamins, glucose)</button>
                                <button class="media-component-button block w-full text-left p-2 rounded hover:bg-blue-200 text-xs sm:text-sm" data-info="Fetal Bovine Serum (FBS) or Fetal Calf Serum (FCS): Typically added at 5-20% (10% is common). It's a complex mixture providing growth factors, hormones, attachment factors, transport proteins, and trace elements. Crucial for the growth of many cell lines. Batch-to-batch variability is a concern. Can be heat-inactivated (56°C for 30 min) to destroy complement proteins that might lyse cells.">2. Fetal Bovine Serum (FBS/FCS) - typically 10%</button>
                                <button class="media-component-button block w-full text-left p-2 rounded hover:bg-blue-200 text-xs sm:text-sm" data-info="L-Glutamine: An essential amino acid required by cells in culture, serving as a nitrogen source for nucleotide and amino acid synthesis, and an energy source. It's unstable in liquid media at 37°C, degrading over time (half-life ~1 week). Often added fresh or a stable dipeptide form like GlutaMAX™ is used. Typical concentration is 2-4 mM.">3. L-Glutamine (or GlutaMAX&trade;) - typically 2-4 mM</button>
                                <button class="media-component-button block w-full text-left p-2 rounded hover:bg-blue-200 text-xs sm:text-sm" data-info="Penicillin-Streptomycin (Pen-Strep): An antibiotic/antimycotic solution typically added at 1% (final concentration ~100 U/mL Penicillin, ~100 µg/mL Streptomycin). Used to prevent bacterial contamination. While common, routine use can mask poor aseptic technique and may lead to antibiotic-resistant strains or affect cell physiology. Should be used judiciously.">4. Penicillin-Streptomycin (optional, but common) - typically 1%</button>
                            </div>
                            <div id="media-prep-component-info" class="media-component-info-box mt-3 p-3 rounded bg-green-100 border border-green-300 text-sm text-green-800" style="display: none;">Click a component to see its description.</div>
                            <p class="text-sm mt-2">Each component is added aseptically under the laminar flow hood.</p>
                        </div>
                        <ul>
                            <li><strong>Phenol Red:</strong> A pH indicator. Medium is typically reddish-orange at pH 7.4. It turns yellow if acidic (e.g., due to excessive cell metabolism or bacterial contamination) and purple if alkaline.</li>
                            <li><strong>Other Additives (depending on cell type/media):</strong> Sodium Bicarbonate (NaHCO<sub>3</sub> - primary buffering component with incubator CO<sub>2</sub>), HEPES buffer (alternative non-$CO_2$ dependent buffer), non-essential amino acids, specific growth factors.</li>
                        </ul>
                        
                        <h4>Sterilization & Aseptic Technique</h4>
                        <p>Sterilization aims to kill or inactivate all viable microorganisms. Aseptic technique refers to the practices used to prevent contamination.</p>
                        <ul>
                            <li><strong>Flaming:</strong> Sterilizing bottle necks, metal tools.</li>
                            <li><strong>UV Light (254nm):</strong> Surface sterilization (e.g., inside hoods). Max 30cm distance. Safety hazard (burns, mutagenesis).</li>
                            <li><strong>Sterile Filtration (0.22 &mu;m filter):</strong> For heat-sensitive liquids like media and serum.</li>
                            <li><strong>Autoclaving (Steam Sterilization):</strong> High pressure and temperature (e.g., 121&deg;C, 15 psi, 15-20 min) for liquids (not media with sensitive components), glassware, and some plastics.</li>
                            <li><strong>Gamma Radiation:</strong> For pre-sterilized plastic consumables (flasks, pipettes).</li>
                        </ul>

                        <h4>Contamination in Cell Culture</h4>
                        <p>Contamination is a major issue in cell culture. Common types include:</p>
                        <ul class="list-none pl-0">
                            <li class="mb-2 p-3 border-l-4 border-red-500 bg-red-50 rounded-r-md">
                                <strong>Bacteria:</strong> Tiny, single-celled prokaryotes.
                                <br><span class="text-xs text-gray-600">Spot them by: Rapid medium turbidity (cloudiness), sudden pH drop (medium turns yellow), and sometimes a "storm" of moving particles visible under the microscope.</span>
                            </li>
                            <li class="mb-2 p-3 border-l-4 border-orange-500 bg-orange-50 rounded-r-md">
                                <strong>Yeasts:</strong> Single-celled eukaryotic fungi.
                                <br><span class="text-xs text-gray-600">Spot them by: Medium may become slightly turbid; individual ovoid or budding particles visible under microscope, often appearing as small, distinct dots or clusters.</span>
                            </li>
                            <li class="mb-2 p-3 border-l-4 border-yellow-500 bg-yellow-50 rounded-r-md">
                                <strong>Molds (Fungi):</strong> Multicellular eukaryotic fungi that grow as hyphae (filaments).
                                <br><span class="text-xs text-gray-600">Spot them by: Visible fuzzy or cotton-like colonies, often on the surface of the medium or flask, and a network of filaments seen under the microscope.</span>
                            </li>
                            <li class="mb-2 p-3 border-l-4 border-purple-500 bg-purple-50 rounded-r-md">
                                <strong>Mycoplasma:</strong> Very small bacteria lacking a cell wall, making them hard to see and filter.
                                <br><span class="text-xs text-gray-600">Spot them by: Often no visible turbidity; signs include slower cell growth, changes in cell morphology, premature yellowing of medium, or a "milky way-like fog" around nuclei when stained with DAPI.</span>
                            </li>
                             <li class="mb-2 p-3 border-l-4 border-teal-500 bg-teal-50 rounded-r-md">
                                <strong>Viruses:</strong> Submicroscopic infectious agents replicating only inside living cells.
                                <br><span class="text-xs text-gray-600">Spot them by: Often no immediate visible signs; may cause cytopathic effects (CPE) like cell rounding or lysis, but diagnosis usually requires specific assays (e.g., ELISA, PCR).</span>
                            </li>
                             <li class="mb-2 p-3 border-l-4 border-gray-500 bg-gray-100 rounded-r-md">
                                <strong>Cross-contamination (other cell lines):</strong> Unwanted presence of a different cell line in the culture.
                                <br><span class="text-xs text-gray-600">Spot them by: Unexpected changes in cell morphology, growth rate, or experimental results; requires specific testing like STR profiling for confirmation.</span>
                            </li>
                        </ul>
                        <div class="interactive-box">
                            <h4>Interactive: Contamination Detective!</h4>
                            <p class="text-sm mb-2">What type of contamination is most likely described in each scenario?</p>
                            <div id="contamination-quiz-module1" class="space-y-4">
                                </div>
                        </div>
                    </div>
                `,
                quiz: [
                    {
                        id: "q1m1", type: "mcq",
                        question: "Which of the following is NOT a typical component of an engineered plasmid used in the lab?",
                        options: ["Origin of Replication (ori)", "Ribosome Binding Site (for bacteria)", "Selection Marker (e.g., antibiotic resistance)", "Telomeres"],
                        answer: "Telomeres",
                        explanation: "Telomeres are found at the ends of linear eukaryotic chromosomes, not typically in circular plasmids."
                    },
                    {
                        id: "q2m1", type: "tf",
                        question: "HEK293 cells are an example of a primary cell culture.",
                        options: ["True", "False"],
                        answer: "False",
                        explanation: "HEK293 cells are a commonly used immortalized cell line, not a primary culture."
                    },
                    {
                        id: "q3m1", type: "mcq",
                        question: "What is the primary role of CO2 in a mammalian cell culture incubator?",
                        options: ["To provide an energy source for the cells", "To maintain the sterility of the culture", "To work with bicarbonate in the medium to buffer pH", "To directly stimulate cell division"],
                        answer: "To work with bicarbonate in the medium to buffer pH",
                        explanation: "CO2 dissolves in the medium to form carbonic acid, which along with bicarbonate ions, forms a buffer system to maintain physiological pH."
                    },
                    {
                        id: "q4m1", type: "mcq",
                        question: "Which sterilization method is most appropriate for heat-sensitive solutions like cell culture media or serum?",
                        options: ["Autoclaving", "Dry Heat Oven", "Sterile Filtration (0.22 µm filter)", "UV Irradiation"],
                        answer: "Sterile Filtration (0.22 µm filter)",
                        explanation: "Sterile filtration removes microorganisms without using heat, which could denature sensitive components in media or serum."
                    },
                    {
                        id: "q5m1", type: "mcq",
                        question: "Your cell culture medium has suddenly become very cloudy and yellow. Under the microscope, you see many tiny, fast-moving particles. What is the most likely contaminant?",
                        options: ["Mycoplasma", "Yeast", "Mold", "Bacteria"],
                        answer: "Bacteria",
                        explanation: "Rapid turbidity, pH drop (yellowing), and visible motile particles are characteristic signs of bacterial contamination."
                    }
                ],
                init: () => {
                    // Plasmid Components Interaction
                    const plasmidButtonsContainer = document.getElementById('plasmid-components-buttons');
                    const plasmidInfoDiv = document.getElementById('plasmid-component-info');

                    if (plasmidButtonsContainer && plasmidInfoDiv) {
                        const plasmidButtons = plasmidButtonsContainer.querySelectorAll('.plasmid-component-btn');
                        plasmidButtons.forEach(button => {
                            button.addEventListener('click', () => {
                                plasmidInfoDiv.innerHTML = button.dataset.info;
                                plasmidInfoDiv.style.display = 'block';
                                plasmidButtons.forEach(btn => btn.classList.remove('ring-2', 'ring-offset-2', 'ring-blue-700', 'scale-105'));
                                button.classList.add('ring-2', 'ring-offset-2', 'ring-blue-700', 'scale-105');
                            });
                        });
                    }

                    // Media Prep Station Interaction
                    const mediaButtonsContainer = document.getElementById('media-components-list');
                    const mediaPrepInfoDiv = document.getElementById('media-prep-component-info');

                    if (mediaButtonsContainer && mediaPrepInfoDiv) {
                        const mediaButtons = mediaButtonsContainer.querySelectorAll('.media-component-button');
                        mediaButtons.forEach(button => {
                            button.addEventListener('click', () => {
                                mediaPrepInfoDiv.innerHTML = button.dataset.info;
                                mediaPrepInfoDiv.style.display = 'block';
                                mediaButtons.forEach(btn => btn.classList.remove('selected'));
                                button.classList.add('selected');
                            });
                        });
                    }
                    
                    // Contamination Detective Quiz for Module 1
                    const contaminationQuizDataModule1 = [
                        { 
                            id: "contam1-m1",
                            description: "Your cell culture medium has suddenly become cloudy, and under the microscope, you see tiny, fast-moving rod-shaped or spherical particles between your cells. The medium has also turned yellow quickly.",
                            options: ["Mycoplasma", "Yeast", "Bacteria", "Viral"],
                            answer: "Bacteria"
                        },
                        {
                            id: "contam2-m1",
                            description: "You notice a 'milky way-like fog' or tiny specks around the nuclei of your cells when stained with DAPI. Cell growth has slowed, and the medium turns yellow faster than usual, but there's no visible cloudiness.",
                            options: ["Fungal (mold)", "Mycoplasma", "Cross-contamination with other cells", "Bacteria"],
                            answer: "Mycoplasma"
                        },
                        {
                            id: "contam3-m1",
                            description: "You see fuzzy, filamentous structures growing in your flask, some of which might be floating on the surface of the medium. Some areas might have a cottony appearance.",
                            options: ["Yeast", "Bacteria", "Fungal (mold)", "Mycoplasma"],
                            answer: "Fungal (mold)"
                        }
                    ];
                    const quizContainerModule1 = document.getElementById('contamination-quiz-module1');
                    if (quizContainerModule1) {
                        quizContainerModule1.innerHTML = ''; // Clear previous content
                        contaminationQuizDataModule1.forEach((q, index) => {
                            const qDiv = document.createElement('div');
                            qDiv.className = 'quiz-question p-4 mb-3 bg-white rounded-lg shadow'; 
                            let optionsHtml = `<p class="font-medium mb-2 text-sm">${index+1}. ${q.description}</p><div class="space-y-1">`;
                            q.options.forEach(opt => {
                                optionsHtml += `<button class="quiz-option text-xs sm:text-sm" data-answer="${q.answer}">${opt}</button>`;
                            });
                            optionsHtml += `</div><div class="feedback-message text-xs mt-2 p-1.5 rounded-md hidden"></div>`;
                            qDiv.innerHTML = optionsHtml;
                            
                            qDiv.querySelectorAll('.quiz-option').forEach(optButton => {
                                optButton.addEventListener('click', () => {
                                    const parentQuestionDiv = optButton.closest('.quiz-question');
                                    parentQuestionDiv.querySelectorAll('.quiz-option').forEach(btn => {
                                        btn.disabled = true;
                                        btn.classList.remove('correct', 'incorrect');
                                    });
                                    const feedbackEl = parentQuestionDiv.querySelector('.feedback-message');
                                    feedbackEl.classList.remove('hidden', 'bg-green-100', 'text-green-700', 'bg-red-100', 'text-red-700');

                                    if (optButton.textContent === q.answer) {
                                        optButton.classList.add('correct');
                                        feedbackEl.innerHTML = '<strong>Correct!</strong>';
                                        feedbackEl.classList.add('bg-green-100', 'text-green-700');
                                    } else {
                                        optButton.classList.add('incorrect');
                                        feedbackEl.innerHTML = `<strong>Incorrect.</strong> Correct answer: ${q.answer}`;
                                        feedbackEl.classList.add('bg-red-100', 'text-red-700');
                                        parentQuestionDiv.querySelectorAll('.quiz-option').forEach(btn => {
                                            if (btn.textContent === q.answer) btn.classList.add('correct');
                                        });
                                    }
                                    feedbackEl.classList.remove('hidden');
                                });
                            });
                            quizContainerModule1.appendChild(qDiv);
                        });
                    }
                }
            },
            {
                id: "module2",
                title: "Module 2: Dilutions, Concentrations & Cell Counting",
                content: () => `
                    <div class="module-content">
                        <h2>Module 2: Mastering Dilutions, Concentrations & Cell Counting</h2>
                        <p>Accurate calculations are fundamental in molecular biology. This module will guide you through essential concepts and practical applications.</p>

                        <h3>Units and Conversions</h3>
                        <p>Understanding and converting between different units of volume and concentration is crucial for accurate lab work.</p>
                        <ul>
                            <li><strong>Volume:</strong> Liters (L), milliliters (mL), microliters (&mu;L)
                                <ul class="list-inside list-disc ml-4 bg-slate-100 p-3 rounded-md shadow-sm">
                                    <li>1 Liter (L) = 1000 milliliters (mL)</li>
                                    <li>1 milliliter (mL) = 1000 microliters (&mu;L)</li>
                                    <li>Therefore, 1 Liter (L) = 1,000,000 microliters (&mu;L)</li>
                                </ul>
                            </li>
                            <li class="mt-2"><strong>Concentration:</strong> Molarity (M = moles/Liter), mg/mL, &mu;g/&mu;L, percentages (%)</li>
                        </ul>
                        <div class="interactive-box">
                            <h4>Interactive: Unit Converter</h4>
                            <p class="text-sm mb-2">Practice converting milliliters (mL) to microliters (&mu;L). Enter a value in mL and click "Convert".</p>
                            <div class="flex flex-wrap items-center gap-2">
                                <label for="ml-input" class="sr-only">Milliliters:</label>
                                <input type="number" id="ml-input" placeholder="Enter mL" class="border p-2 rounded w-32 text-sm">
                                <button class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded text-sm" onclick="convertUnits()">Convert to &mu;L</button>
                            </div>
                            <p id="ul-output" class="mt-2 text-sm font-medium text-blue-700"></p>
                        </div>

                        <h3>The Dilution Formula: <span class="formula">C<sub>1</sub> &times; V<sub>1</sub> = C<sub>2</sub> &times; V<sub>2</sub></span></h3>
                        <p>This is the cornerstone formula for calculating dilutions. It states that the amount of solute remains constant before and after dilution.</p>
                        <ul class="bg-slate-100 p-3 rounded-md shadow-sm">
                            <li><strong>C<sub>1</sub></strong> = Initial concentration (concentration of your stock solution)</li>
                            <li><strong>V<sub>1</sub></strong> = Initial volume (the volume of stock solution you need to take)</li>
                            <li><strong>C<sub>2</sub></strong> = Final concentration (the desired concentration of your diluted solution)</li>
                            <li><strong>V<sub>2</sub></strong> = Final volume (the total volume of your desired diluted solution)</li>
                        </ul>
                        <p class="mt-2"><strong>Example:</strong> You need to prepare 10 mL of a 0.1 mg/mL solution from a 1 mg/mL stock solution.</p>
                        <ul class="text-sm">
                            <li>C<sub>1</sub> = 1 mg/mL (stock concentration)</li>
                            <li>C<sub>2</sub> = 0.1 mg/mL (desired final concentration)</li>
                            <li>V<sub>2</sub> = 10 mL (desired final volume)</li>
                        </ul>
                        <p>We need to find V<sub>1</sub> (the volume of stock to use).</p>
                        <p>Rearranging the formula: <span class="formula">V<sub>1</sub> = (C<sub>2</sub> &times; V<sub>2</sub>) / C<sub>1</sub></span></p>
                        <p><span class="formula">V<sub>1</sub> = (0.1 mg/mL &times; 10 mL) / 1 mg/mL = 1 mL</span></p>
                        <p><strong>Conclusion:</strong> You would take 1 mL of the 1 mg/mL stock solution and add 9 mL of diluent (e.g., water or buffer) to make a total final volume of 10 mL with a concentration of 0.1 mg/mL.</p>
                        
                        <div class="interactive-box">
                            <h4>Interactive: Dilution Calculator (C1V1 = C2V2)</h4>
                            <p class="text-sm mb-3">Enter any three values (C1, V1, C2, V2) and their respective units. The calculator will determine the missing value, performing necessary unit conversions.</p>
                            <div class="calculator grid grid-cols-1 sm:grid-cols-2 gap-x-4 gap-y-3 items-end">
                                <div>
                                    <label for="c1_calc_val" class="block text-sm font-medium text-gray-700">C<sub>1</sub> (Stock Conc.):</label>
                                    <div class="flex">
                                        <input type="number" id="c1_calc_val" placeholder="e.g., 10" class="w-2/3 mt-1">
                                        <select id="c1_calc_unit" class="w-1/3 mt-1 ml-1">
                                            <option value="M">M</option><option value="mM">mM</option><option value="uM">&mu;M</option><option value="nM">nM</option>
                                            <option value="g/L">g/L</option><option value="mg/mL">mg/mL</option><option value="ug/mL">&mu;g/mL</option><option value="ng/uL">ng/&mu;L</option>
                                            <option value="percent">%</option><option value="X">X</option>
                                        </select>
                                    </div>
                                </div>
                                <div>
                                    <label for="v1_calc_val" class="block text-sm font-medium text-gray-700">V<sub>1</sub> (Stock Vol.):</label>
                                     <div class="flex">
                                        <input type="number" id="v1_calc_val" placeholder="e.g., ?" class="w-2/3 mt-1">
                                        <select id="v1_calc_unit" class="w-1/3 mt-1 ml-1">
                                            <option value="L">L</option><option value="mL" selected>mL</option><option value="uL">&mu;L</option>
                                        </select>
                                    </div>
                                </div>
                                <div>
                                    <label for="c2_calc_val" class="block text-sm font-medium text-gray-700">C<sub>2</sub> (Final Conc.):</label>
                                    <div class="flex">
                                        <input type="number" id="c2_calc_val" placeholder="e.g., 1" class="w-2/3 mt-1">
                                        <select id="c2_calc_unit" class="w-1/3 mt-1 ml-1">
                                            <option value="M">M</option><option value="mM">mM</option><option value="uM">&mu;M</option><option value="nM">nM</option>
                                            <option value="g/L">g/L</option><option value="mg/mL">mg/mL</option><option value="ug/mL">&mu;g/mL</option><option value="ng/uL">ng/&mu;L</option>
                                            <option value="percent">%</option><option value="X">X</option>
                                        </select>
                                    </div>
                                </div>
                                <div>
                                    <label for="v2_calc_val" class="block text-sm font-medium text-gray-700">V<sub>2</sub> (Final Vol.):</label>
                                    <div class="flex">
                                        <input type="number" id="v2_calc_val" placeholder="e.g., 100" class="w-2/3 mt-1">
                                        <select id="v2_calc_unit" class="w-1/3 mt-1 ml-1">
                                            <option value="L">L</option><option value="mL" selected>mL</option><option value="uL">&mu;L</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="sm:col-span-2 mt-2">
                                    <button onclick="calculateDilutionWithUnits()" class="w-full py-2">Calculate Missing Value</button>
                                </div>
                            </div>
                            <div id="dilution-result-container" class="mt-3 p-3 bg-white rounded-md shadow hidden">
                                <p id="dilution-result" class="font-semibold text-blue-700"></p>
                                <p id="dilution-steps" class="mt-1 text-sm text-gray-600"></p>
                            </div>
                        </div>

                        <h3>Cell Counting with a Hemocytometer (Neubauer Chamber)</h3>
                        <p>A hemocytometer is a specialized counting chamber slide used to determine the concentration of cells in a liquid sample.</p>
                        <img src="https://placehold.co/400x300/E0E0E0/666666?text=Neubauer+Chamber+Example" alt="Neubauer chamber counting grid with example cells" class="my-4 rounded-lg shadow-md mx-auto block max-w-full sm:max-w-md w-auto" onerror="this.onerror=null;this.src='https://placehold.co/400x300/E0E0E0/B0B0B0?text=Image+Not+Found';">
                        
                        <p class="text-xs text-center text-gray-500 -mt-2 mb-4">Example of cell counting in one square of a Neubauer grid. Green checks indicate cells to count; red X's indicate cells not to count based on a common counting rule (e.g., count cells on top and left lines, exclude bottom and right).</p>
                        <p><strong>General Procedure:</strong></p>
                        <ul class="bg-slate-100 p-3 rounded-md shadow-sm">
                            <li>Clean the hemocytometer and coverslip.
                            <li>Mix your cell suspension thoroughly. Often, cells are mixed 1:1 with Trypan Blue stain (e.g., 10 &mu;L cells + 10 &mu;L Trypan Blue). Trypan Blue stains dead cells blue, allowing for viability assessment. This creates a <strong>dilution factor of 2</strong>.</li>
                            <li>Carefully load about 10 &mu;L of the cell suspension/Trypan Blue mixture into one side of the hemocytometer chamber. Avoid overfilling.</li>
                            <li>Under a microscope (typically at 10x objective), focus on the grid lines.</li>
                            <li>Count the cells in the 4 large corner squares (each 1mm &times; 1mm, subdivided into 16 smaller squares). For consistency, establish a counting rule (e.g., count cells touching the top and left lines, but not the bottom and right lines).</li>
                            <li>The volume of one large square (1mm x 1mm) with a standard coverslip depth of 0.1mm is 1mm &times; 1mm &times; 0.1mm = 0.1 mm<sup>3</sup> = 0.1 &mu;L = 1 x 10<sup>-4</sup> mL.</li>
                        </ul>
                        <p><strong>Calculation:</strong></p>
                        <p><span class="formula">Cells/mL = (Average cells per large square) &times; Dilution Factor &times; 10<sup>4</sup></span></p>
                        <p>Where 10<sup>4</sup> is the conversion factor (since each large square is 10<sup>-4</sup> mL).</p>
                        
                        <div class="interactive-box">
                            <h4>Interactive: Cell Count Calculator</h4>
                            <p class="text-sm mb-3">Enter the total number of live (unstained) cells counted in the 4 large corner squares and the dilution factor used.</p>
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-x-4 gap-y-3 items-center">
                                <div>
                                    <label for="cells-counted" class="block text-sm font-medium text-gray-700">Total live cells in 4 large squares:</label>
                                    <input type="number" id="cells-counted" placeholder="e.g., 240" class="w-full mt-1">
                                </div>
                                <div>
                                    <label for="dilution-factor" class="block text-sm font-medium text-gray-700">Dilution factor (e.g., 2 for 1:1 mix):</label>
                                    <input type="number" id="dilution-factor" value="2" class="w-full mt-1">
                                </div>
                                <div class="sm:col-span-2 mt-2">
                                    <button class="bg-green-500 hover:bg-green-600 text-white px-3 py-2 rounded text-sm w-full" onclick="calculateCellDensity()">Calculate Cell Density (cells/mL)</button>
                                </div>
                            </div>
                            <p id="cell-density-output" class="mt-3 font-semibold text-green-700"></p>
                        </div>
                        
                        <h3>Practice Problems</h3>
                        <p>Test your understanding with these common lab scenarios. Enter your answers and click "Check Answer".</p>
                        <div id="practice-problems-container" class="space-y-6">
                            <div class="practice-problem-box">
                                <p class="font-semibold">1. BSA Dilution:</p>
                                <p>You need to prepare 1 mL of 5% BSA (Bovine Serum Albumin) solution in PBS from a 100% (w/v) BSA stock. How much stock BSA and PBS do you need?</p>
                                <div class="mt-2 space-y-2 sm:space-y-0 sm:flex sm:items-end sm:gap-3">
                                    <div>
                                        <label for="bsa-stock-input" class="block text-xs font-medium text-gray-600">Stock BSA (&mu;L):</label>
                                        <input type="number" id="bsa-stock-input" placeholder="e.g., 50" class="text-sm p-1 w-28">
                                    </div>
                                    <div>
                                        <label for="pbs-input" class="block text-xs font-medium text-gray-600">PBS (&mu;L):</label>
                                        <input type="number" id="pbs-input" placeholder="e.g., 950" class="text-sm p-1 w-28">
                                    </div>
                                    <button onclick="checkPracticeAnswer('bsa-dilution', [50, 950], ['bsa-stock-input', 'pbs-input'])" class="text-sm px-3 py-1.5">Check Answer</button>
                                </div>
                                <div id="bsa-dilution-feedback" class="practice-feedback text-sm mt-2 hidden"></div>
                                <div id="bsa-dilution-solution" class="solution-details hidden">
                                    <strong>Detailed Solution:</strong><br>
                                    Using C<sub>1</sub>V<sub>1</sub> = C<sub>2</sub>V<sub>2</sub>:<br>
                                    C<sub>1</sub> (Stock Conc.) = 100%<br>
                                    C<sub>2</sub> (Final Conc.) = 5%<br>
                                    V<sub>2</sub> (Final Vol.) = 1 mL<br>
                                    V<sub>1</sub> (Stock BSA Vol.) = (C<sub>2</sub> &times; V<sub>2</sub>) / C<sub>1</sub> = (5% &times; 1 mL) / 100% = 0.05 mL.<br>
                                    Convert to &mu;L: 0.05 mL &times; 1000 &mu;L/mL = <strong>50 &mu;L of 100% BSA stock</strong>.<br>
                                    Volume of PBS (Diluent) = V<sub>2</sub> - V<sub>1</sub> = 1 mL - 0.05 mL = 0.95 mL.<br>
                                    Convert to &mu;L: 0.95 mL &times; 1000 &mu;L/mL = <strong>950 &mu;L of PBS</strong>.
                                </div>
                            </div>

                            <div class="practice-problem-box">
                                <p class="font-semibold">2. Triton X-100 Dilution:</p>
                                <p>You need to prepare 10 mL of 0.1% Triton X-100 solution from a 10% (v/v) stock solution. How much stock Triton X-100 and diluent do you need?</p>
                                <div class="mt-2 space-y-2 sm:space-y-0 sm:flex sm:items-end sm:gap-3">
                                    <div>
                                        <label for="triton-stock-input" class="block text-xs font-medium text-gray-600">Stock Triton X-100 (&mu;L):</label>
                                        <input type="number" id="triton-stock-input" placeholder="e.g., 100" class="text-sm p-1 w-36">
                                    </div>
                                    <div>
                                        <label for="triton-diluent-input" class="block text-xs font-medium text-gray-600">Diluent (mL):</label>
                                        <input type="number" step="0.1" id="triton-diluent-input" placeholder="e.g., 9.9" class="text-sm p-1 w-28">
                                    </div>
                                    <button onclick="checkPracticeAnswer('triton-dilution', [100, 9.9], ['triton-stock-input', 'triton-diluent-input'])" class="text-sm px-3 py-1.5">Check Answer</button>
                                </div>
                                <div id="triton-dilution-feedback" class="practice-feedback text-sm mt-2 hidden"></div>
                                <div id="triton-dilution-solution" class="solution-details hidden">
                                    <strong>Detailed Solution:</strong><br>
                                    Using C<sub>1</sub>V<sub>1</sub> = C<sub>2</sub>V<sub>2</sub>:<br>
                                    C<sub>1</sub> (Stock Conc.) = 10%<br>
                                    C<sub>2</sub> (Final Conc.) = 0.1%<br>
                                    V<sub>2</sub> (Final Vol.) = 10 mL<br>
                                    V<sub>1</sub> (Stock Triton Vol.) = (C<sub>2</sub> &times; V<sub>2</sub>) / C<sub>1</sub> = (0.1% &times; 10 mL) / 10% = 0.1 mL.<br>
                                    Convert to &mu;L: 0.1 mL &times; 1000 &mu;L/mL = <strong>100 &mu;L of 10% Triton X-100 stock</strong>.<br>
                                    Volume of Diluent = V<sub>2</sub> - V<sub>1</sub> = 10 mL - 0.1 mL = <strong>9.9 mL</strong>.
                                </div>
                            </div>

                            <div class="practice-problem-box">
                                <p class="font-semibold">3. Secondary Antibody Dilution (for 6 wells):</p>
                                <p>You need to prepare a secondary antibody solution for 6 wells of a plate. Each well requires 200 &mu;L of antibody solution at a 1:1000 dilution from a concentrated stock. How much antibody stock and buffer do you need for exactly 6 wells?</p>
                                <div class="mt-2 space-y-2 sm:space-y-0 sm:flex sm:items-end sm:gap-3">
                                    <div>
                                        <label for="antibody-stock-input" class="block text-xs font-medium text-gray-600">Antibody Stock (&mu;L):</label>
                                        <input type="number" step="0.1" id="antibody-stock-input" placeholder="e.g., 1.2" class="text-sm p-1 w-32">
                                    </div>
                                    <div>
                                        <label for="antibody-buffer-input" class="block text-xs font-medium text-gray-600">Buffer (&mu;L):</label>
                                        <input type="number" step="0.1" id="antibody-buffer-input" placeholder="e.g., 1198.8" class="text-sm p-1 w-32">
                                    </div>
                                    <button onclick="checkPracticeAnswer('antibody-dilution', [1.2, 1198.8], ['antibody-stock-input', 'antibody-buffer-input'])" class="text-sm px-3 py-1.5">Check Answer</button>
                                </div>
                                <div id="antibody-dilution-feedback" class="practice-feedback text-sm mt-2 hidden"></div>
                                <div id="antibody-dilution-solution" class="solution-details hidden">
                                    <strong>Detailed Solution (for 6 wells exactly):</strong><br>
                                    Total volume needed (V<sub>final</sub>) = Number of wells &times; Volume per well = 6 wells &times; 200 &mu;L/well = 1200 &mu;L.<br>
                                    Dilution factor = 1000.<br>
                                    Volume of antibody stock (V<sub>stock</sub>) = V<sub>final</sub> / Dilution factor = 1200 &mu;L / 1000 = <strong>1.2 &mu;L</strong>.<br>
                                    Volume of buffer = V<sub>final</sub> - V<sub>stock</sub> = 1200 &mu;L - 1.2 &mu;L = <strong>1198.8 &mu;L</strong>.<br>
                                    <em>(Note: In practice, you'd prepare a bit extra, e.g., for 6.5 or 7 wells, to account for pipetting inaccuracies.)</em>
                                </div>
                            </div>

                            <div class="practice-problem-box">
                                <p class="font-semibold">4. Cell Plating:</p>
                                <p>You have a cell stock with a concentration of 1 &times; 10<sup>6</sup> cells/mL. You want to plate 2 &times; 10<sup>5</sup> cells into each well. What volume of your cell stock do you need to add to each well?</p>
                                <div class="mt-2 space-y-2 sm:space-y-0 sm:flex sm:items-end sm:gap-3">
                                    <div>
                                        <label for="cell-plating-input" class="block text-xs font-medium text-gray-600">Cell Stock Volume per well (&mu;L):</label>
                                        <input type="number" id="cell-plating-input" placeholder="e.g., 200" class="text-sm p-1 w-48">
                                    </div>
                                    <button onclick="checkPracticeAnswer('cell-plating', [200], ['cell-plating-input'])" class="text-sm px-3 py-1.5">Check Answer</button>
                                </div>
                                <div id="cell-plating-feedback" class="practice-feedback text-sm mt-2 hidden"></div>
                                <div id="cell-plating-solution" class="solution-details hidden">
                                    <strong>Detailed Solution:</strong><br>
                                    Desired cells per well = 2 &times; 10<sup>5</sup> cells.<br>
                                    Stock concentration = 1 &times; 10<sup>6</sup> cells/mL.<br>
                                    Volume needed per well = (Desired cells per well) / (Stock concentration)<br>
                                    Volume = (2 &times; 10<sup>5</sup> cells) / (1 &times; 10<sup>6</sup> cells/mL) = 0.2 mL.<br>
                                    Convert to &mu;L: 0.2 mL &times; 1000 &mu;L/mL = <strong>200 &mu;L per well</strong>.
                                </div>
                            </div>
                        </div>
                    </div>
                `,
                quiz: [
                    {
                        id: "q1m2", type: "mcq",
                        question: "If you have a 10X stock solution of Tris buffer and you want to make 500 mL of 1X Tris buffer, how much of the 10X stock do you need?",
                        options: ["5 mL", "10 mL", "50 mL", "100 mL"],
                        answer: "50 mL",
                        explanation: "Using C1V1 = C2V2: (10X)(V1) = (1X)(500 mL). So, V1 = (1 * 500) / 10 = 50 mL."
                    },
                    {
                        id: "q2m2", type: "tf",
                        question: "When counting cells with a hemocytometer, the depth of the chamber (with a standard coverslip) is typically 1 mm.",
                        options: ["True", "False"],
                        answer: "False",
                        explanation: "The standard depth of a hemocytometer chamber is 0.1 mm, not 1 mm."
                    },
                    {
                        id: "q3m2", type: "mcq",
                        question: "You count an average of 75 cells per large square in a hemocytometer. You mixed your cells 1:1 with Trypan Blue before counting. What is the concentration of live cells in your original sample (cells/mL)?",
                        options: ["7.5 x 10^4 cells/mL", "1.5 x 10^5 cells/mL", "7.5 x 10^5 cells/mL", "1.5 x 10^6 cells/mL"],
                        answer: "1.5 x 10^6 cells/mL",
                        explanation: "Cells/mL = (Avg cells/square) * Dilution Factor * 10^4 = 75 * 2 * 10^4 = 150 * 10^4 = 1.5 x 10^6 cells/mL."
                    },
                     {
                        id: "q4m2", type: "mcq",
                        question: "To make 200 mL of a 50 mM NaCl solution from a 2 M NaCl stock, how much stock solution do you need?",
                        options: ["0.5 mL", "5 mL", "50 mL", "2.5 mL"],
                        answer: "5 mL",
                        explanation: "C1=2 M = 2000 mM, V1=?, C2=50 mM, V2=200 mL. V1 = (C2*V2)/C1 = (50 mM * 200 mL) / 2000 mM = 10000 / 2000 = 5 mL."
                    }
                ],
                init: () => {
                    // No specific init needed for static content beyond what's globally handled by calculateDilutionWithUnits etc.
                    // If there were specific interactive elements for Module 2 other than the calculators, they'd be initialized here.
                }
            }
            // Add more modules here if needed
        ];

        // --- CORE UI LOGIC ---
        const sidebar = document.getElementById('sidebar');
        const mainContent = document.getElementById('main-content');
        const welcomeMessage = document.getElementById('welcome-message');

        function loadModule(moduleId) {
            const moduleData = modulesData.find(m => m.id === moduleId);
            if (moduleData && mainContent) {
                if (welcomeMessage) welcomeMessage.style.display = 'none';
                mainContent.innerHTML = moduleData.content(); // Render module content

                // Render quiz if it exists for the module
                if (moduleData.quiz && moduleData.quiz.length > 0) {
                    const quizHtml = `
                        <div class="mt-8 pt-6 border-t-2 border-blue-300">
                            <h3 class="text-xl font-semibold text-blue-700 mb-4">Module Quiz!</h3>
                            <p class="text-sm text-gray-600 mb-4">Test your knowledge from this module. Select an answer for each question.</p>
                            <div id="quiz-container-${moduleId}"></div>
                        </div>
                    `;
                    mainContent.insertAdjacentHTML('beforeend', quizHtml);
                    renderQuiz(moduleData.quiz, `quiz-container-${moduleId}`);
                }
                
                // Call module-specific initialization function
                if (moduleData.init && typeof moduleData.init === 'function') {
                    try {
                        moduleData.init(); 
                    } catch (error) {
                        console.error("Error during module initialization for " + moduleId + ":", error);
                    }
                }

                // Update active link in sidebar
                document.querySelectorAll('.sidebar-link').forEach(link => {
                    link.classList.remove('active', 'bg-slate-700', 'text-yellow-400');
                    if (link.dataset.moduleId === moduleId) {
                        link.classList.add('active', 'bg-slate-700', 'text-yellow-400');
                    }
                });
            } else if (!mainContent) {
                console.error("Error: Main content container not found.");
            } else {
                console.warn(`Module with ID "${moduleId}" not found.`);
                if(welcomeMessage) welcomeMessage.style.display = 'block'; 
            }
        }

        function renderQuiz(quizData, containerId) {
            const quizContainer = document.getElementById(containerId);
            if (!quizContainer) {
                console.error(`Quiz container with ID "${containerId}" not found.`);
                return; 
            }
            quizContainer.innerHTML = ''; // Clear previous quiz content

            quizData.forEach((q, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'quiz-question';
                
                let optionsHtml = '';
                if (q.type === 'mcq' || q.type === 'tf') { 
                    q.options.forEach(optionText => {
                        const escapedOptionValue = optionText.replace(/"/g, '&quot;'); // Handle quotes in option text
                        optionsHtml += `<button class="quiz-option" data-question-index="${index}" data-option-value="${escapedOptionValue}">${optionText}</button>`;
                    });
                }

                questionDiv.innerHTML = `
                    <p class="font-medium mb-3">${index + 1}. ${q.question}</p>
                    <div class="space-y-2">${optionsHtml}</div>
                    <div class="feedback-message text-sm mt-2 p-2 rounded-md hidden"></div>
                `;
                quizContainer.appendChild(questionDiv);
            });

            // Add event listener to the quiz container (event delegation)
            quizContainer.addEventListener('click', function(event) {
                if (event.target.classList.contains('quiz-option')) {
                    const selectedOptionButton = event.target;
                    const questionIndex = parseInt(selectedOptionButton.dataset.questionIndex);
                    const questionData = quizData[questionIndex];
                    const feedbackDiv = selectedOptionButton.closest('.quiz-question').querySelector('.feedback-message');
                    const selectedValue = selectedOptionButton.dataset.optionValue;

                    // Disable all options for this question and clear previous styling
                    selectedOptionButton.parentElement.querySelectorAll('.quiz-option').forEach(btn => {
                        btn.disabled = true;
                        btn.classList.remove('correct', 'incorrect'); 
                    });
                    
                    feedbackDiv.classList.remove('hidden', 'bg-green-100', 'text-green-700', 'bg-red-100', 'text-red-700'); 

                    if (selectedValue === questionData.answer) {
                        selectedOptionButton.classList.add('correct');
                        feedbackDiv.innerHTML = '<strong>Correct!</strong> '; 
                        feedbackDiv.classList.add('bg-green-100', 'text-green-700');
                    } else {
                        selectedOptionButton.classList.add('incorrect');
                        feedbackDiv.innerHTML = `<strong>Incorrect.</strong> The correct answer is: <span class="font-semibold">${questionData.answer}</span>. `;
                        feedbackDiv.classList.add('bg-red-100', 'text-red-700');
                        // Highlight the correct answer if the user was wrong
                        selectedOptionButton.parentElement.querySelectorAll('.quiz-option').forEach(btn => {
                            if (btn.dataset.optionValue === questionData.answer) {
                                btn.classList.add('correct'); 
                            }
                        });
                    }
                    if(questionData.explanation) {
                        feedbackDiv.innerHTML += `<br><span class="text-xs">${questionData.explanation}</span>`;
                    }
                    feedbackDiv.classList.remove('hidden'); 
                }
            });
        }

        function populateSidebar() {
            if (!sidebar) return; 
            // Clear existing links first if any (e.g. if this function could be called multiple times)
            const existingLinks = sidebar.querySelectorAll('a.sidebar-link');
            existingLinks.forEach(link => link.remove());
            
            modulesData.forEach(module => {
                const link = document.createElement('a');
                link.href = '#'; // Prevent page reload
                link.textContent = module.title;
                link.className = 'block py-2.5 px-4 rounded sidebar-link text-slate-200 hover:bg-slate-600 hover:text-yellow-300 focus:outline-none focus:ring-2 focus:ring-yellow-400 transition-colors duration-150 text-sm';
                link.dataset.moduleId = module.id;
                link.addEventListener('click', (e) => {
                    e.preventDefault(); // Prevent default anchor behavior
                    loadModule(module.id);
                });
                sidebar.appendChild(link);
            });
        }
        
        // --- MODULE 2 SPECIFIC FUNCTIONS ---
        function convertUnits() {
            const mlInput = document.getElementById('ml-input');
            const outputP = document.getElementById('ul-output');
            if (!mlInput || !outputP) {
                // console.error("Missing elements for unit conversion.");
                return; 
            }

            const mlVal = parseFloat(mlInput.value);
            if (!isNaN(mlVal)) {
                outputP.innerHTML = `${mlVal} mL = <span class="font-bold">${(mlVal * 1000).toLocaleString()} &mu;L</span>`;
                outputP.classList.remove('text-red-600');
                outputP.classList.add('text-blue-700');
            } else {
                outputP.textContent = 'Please enter a valid number for mL.';
                outputP.classList.remove('text-blue-700');
                outputP.classList.add('text-red-600');
            }
        }

        // --- CORRECTED DILUTION CALCULATOR WITH UNIT CONVERSION ---
        function calculateDilutionWithUnits() {
            const c1ValEl = document.getElementById('c1_calc_val');
            const c1UnitEl = document.getElementById('c1_calc_unit');
            const v1ValEl = document.getElementById('v1_calc_val');
            const v1UnitEl = document.getElementById('v1_calc_unit');
            const c2ValEl = document.getElementById('c2_calc_val');
            const c2UnitEl = document.getElementById('c2_calc_unit');
            const v2ValEl = document.getElementById('v2_calc_val');
            const v2UnitEl = document.getElementById('v2_calc_unit');

            const resultP = document.getElementById('dilution-result');
            const stepsP = document.getElementById('dilution-steps');
            const resultContainer = document.getElementById('dilution-result-container');

            if (!c1ValEl || !c1UnitEl || !v1ValEl || !v1UnitEl || !c2ValEl || !c2UnitEl || !v2ValEl || !v2UnitEl || !resultP || !stepsP || !resultContainer) {
                if(resultP) resultP.textContent = "Calculator elements are missing. Cannot perform calculation.";
                if(resultContainer) resultContainer.classList.remove('hidden');
                console.error("Dilution calculator elements missing.");
                return;
            }
            
            resultP.innerHTML = ''; 
            stepsP.innerHTML = '';  
            resultContainer.classList.add('hidden'); 

            // --- Unit Conversion Factors ---
            // Base for concentration: Molar (M)
            // Base for mass/volume: g/L (equivalent to mg/mL or µg/µL)
            // Base for percent/X: Treat them as direct ratios
            const concFactorsToMolar = {
                'M': 1, 'mM': 1e-3, 'uM': 1e-6, 'nM': 1e-9,
            };
            const concFactorsToGramsPerLiter = {
                'g/L': 1, 'mg/mL': 1, 'ug/mL': 1e-3, 'ng/uL': 1, // ng/µL is same as mg/mL
                // For percent and X, we handle them differently as they are relative
            };
            // Base for volume: mL
            const volFactorsToML = { 'L': 1000, 'mL': 1, 'uL': 1e-3 };

            // Helper function to get value in base unit
            const getValueInBase = (valStr, unit, type) => {
                const val = parseFloat(valStr);
                if (isNaN(val)) return NaN;

                if (type === 'conc') {
                    if (unit === '%' || unit === 'X') return val; // Keep as is for now
                    if (concFactorsToMolar[unit]) return val * concFactorsToMolar[unit];
                    if (concFactorsToGramsPerLiter[unit]) return val * concFactorsToGramsPerLiter[unit]; // This needs careful thought if mixing molar and mass/vol
                    return NaN; // Unknown unit
                } else if (type === 'vol') {
                    return val * volFactorsToML[unit];
                }
                return NaN;
            };
            
            // Get original units for output
            const c1UnitOrig = c1UnitEl.value;
            const v1UnitOrig = v1UnitEl.value;
            const c2UnitOrig = c2UnitEl.value;
            const v2UnitOrig = v2UnitEl.value;

            // Check if units are compatible (e.g. don't mix molar with g/L directly without MW)
            // For simplicity, this version assumes units within C1/C2 are of the same "type" (molar, mass/vol, or relative)
            // and V1/V2 are volume units.
            // A more robust calculator would handle MW for molar to mass/vol conversions.
            // This version will primarily focus on converting within the same type of unit (e.g. M to mM, mL to L)

            let c1_val = parseFloat(c1ValEl.value);
            let v1_val = parseFloat(v1ValEl.value);
            let c2_val = parseFloat(c2ValEl.value);
            let v2_val = parseFloat(v2ValEl.value);

            // Determine which value is missing
            let missingCount = 0;
            if (isNaN(c1_val)) missingCount++;
            if (isNaN(v1_val)) missingCount++;
            if (isNaN(c2_val)) missingCount++;
            if (isNaN(v2_val)) missingCount++;

            if (missingCount !== 1) {
                resultP.textContent = "Error: Please provide exactly 3 values to calculate the fourth.";
                resultP.className = "font-semibold text-red-600";
                resultContainer.classList.remove('hidden');
                return;
            }

            // Convert all provided values to a consistent set of base units for calculation
            // For concentrations: convert to the unit of the first defined concentration value if possible, or a common base.
            // Let's use a simple approach: convert all to a single base unit type if they are compatible.
            // If C1 is molar, C2 must be molar. If C1 is g/L, C2 must be g/L. % and X are relative.

            let c1_base = NaN, v1_base = NaN, c2_base = NaN, v2_base = NaN;
            let targetConcUnitForOutput = c1UnitOrig; // Default
            let targetVolUnitForOutput = v1UnitOrig; // Default

            // --- Convert to Base Units (mL for volume, M for molar, g/L for mass/vol) ---
            // This simplified version will assume units are compatible or relative (X, %)
            // A full implementation would need more sophisticated unit compatibility checks.

            const getVal = (valEl, unitEl) => parseFloat(valEl.value);
            const getUnit = (unitEl) => unitEl.value;

            c1_val = getVal(c1ValEl, c1UnitEl);
            let c1_unit = getUnit(c1UnitEl);
            v1_val = getVal(v1ValEl, v1UnitEl);
            let v1_unit = getUnit(v1UnitEl);
            c2_val = getVal(c2ValEl, c2UnitEl);
            let c2_unit = getUnit(c2UnitEl);
            v2_val = getVal(v2ValEl, v2UnitEl);
            let v2_unit = getUnit(v2UnitEl);

            // Convert volumes to mL for internal calculation
            if (!isNaN(v1_val)) v1_base = v1_val * (volFactorsToML[v1_unit] || 1);
            if (!isNaN(v2_val)) v2_base = v2_val * (volFactorsToML[v2_unit] || 1);

            // Convert concentrations to a base (e.g., M for molar, g/L for mass/vol)
            // This part needs to be robust. For now, let's assume units are of the same "type" or relative.
            // If C1 is 'X' or '%', C2 must also be 'X' or '%', or one is 1X/100% by implication.
            
            // Simplification: if units are 'X' or '%', treat values directly.
            // Otherwise, convert to a common factor if possible (e.g. M, mM, uM all go to M)
            // This is a HARD problem to generalize without a full unit parsing/conversion library.
            // For this fix, we'll assume the user picks compatible concentration types (e.g., all molar, or all g/L based, or all relative)
            // and we convert them to the "largest" unit in that category for calculation.

            // Let's try converting concentrations to their "base" equivalent (e.g., M for molar, g/L for mass/vol)
            const convertConcToBase = (val, unit) => {
                if (isNaN(val)) return NaN;
                if (concFactorsToMolar[unit]) return val * concFactorsToMolar[unit]; // Base is M
                if (concFactorsToGramsPerLiter[unit]) return val * concFactorsToGramsPerLiter[unit]; // Base is g/L
                if (unit === '%' || unit === 'X') return val; // Relative, use as is
                return NaN; // Unknown or incompatible
            };
            
            if (!isNaN(c1_val)) c1_base = convertConcToBase(c1_val, c1_unit);
            if (!isNaN(c2_val)) c2_base = convertConcToBase(c2_val, c2_unit);

            // Check if concentration types are compatible (e.g. M vs g/L) - this is tricky
            // For now, if one is molar and other is mass/vol, and neither is X or %, it's an error
            const isMolar = (unit) => !!concFactorsToMolar[unit];
            const isMassVol = (unit) => !!concFactorsToGramsPerLiter[unit];
            const isRelative = (unit) => unit === '%' || unit === 'X';

            if (!isNaN(c1_val) && !isNaN(c2_val)) {
                if ((isMolar(c1_unit) && isMassVol(c2_unit)) || (isMassVol(c1_unit) && isMolar(c2_unit))) {
                     resultP.textContent = "Error: Cannot directly mix molar (M, mM, etc.) and mass/volume (g/L, mg/mL, etc.) concentrations without molecular weight. Please use compatible units.";
                     resultP.className = "font-semibold text-red-600";
                     resultContainer.classList.remove('hidden');
                     return;
                }
            }


            let calculatedValue = NaN;
            let calculatedUnit = "";
            let diluentVol_base = NaN;
            let calculationStepsStr = "";

            if (isNaN(c1_base) && !isNaN(v1_base) && !isNaN(c2_base) && !isNaN(v2_base)) { // Calculate C1
                if (v1_base === 0) { resultP.textContent = "Error: V1 (Stock Volume) cannot be zero."; resultP.className = "font-semibold text-red-600"; resultContainer.classList.remove('hidden'); return; }
                calculatedValue = (c2_base * v2_base) / v1_base;
                targetConcUnitForOutput = c1UnitOrig; // Output in the unit selected for C1
                // Convert calculatedValue (which is in base unit for conc) back to targetConcUnitForOutput
                if (concFactorsToMolar[targetConcUnitForOutput]) calculatedValue /= concFactorsToMolar[targetConcUnitForOutput];
                else if (concFactorsToGramsPerLiter[targetConcUnitForOutput]) calculatedValue /= concFactorsToGramsPerLiter[targetConcUnitForOutput];
                // For % or X, it should already be in the correct relative value if c2_base was also relative.
                
                c1ValEl.value = calculatedValue.toPrecision(4);
                calculationStepsStr = `C<sub>1</sub> = (C<sub>2</sub> &times; V<sub>2</sub>) / V<sub>1</sub> = (${c2_val} ${c2_unit} &times; ${v2_val} ${v2_unit}) / ${v1_val} ${v1_unit}`;
                resultP.innerHTML = `Calculated Stock Concentration (C<sub>1</sub>) = <strong>${calculatedValue.toPrecision(4)} ${targetConcUnitForOutput}</strong>`;
            } else if (isNaN(v1_base) && !isNaN(c1_base) && !isNaN(c2_base) && !isNaN(v2_base)) { // Calculate V1
                if (c1_base === 0) { resultP.textContent = "Error: C1 (Stock Concentration) cannot be zero."; resultP.className = "font-semibold text-red-600"; resultContainer.classList.remove('hidden'); return; }
                calculatedValue = (c2_base * v2_base) / c1_base; // This is in mL (v_base)
                diluentVol_base = v2_base - calculatedValue;
                targetVolUnitForOutput = v1UnitOrig; // Output in the unit selected for V1
                // Convert calculatedValue (mL) back to targetVolUnitForOutput
                calculatedValue /= (volFactorsToML[targetVolUnitForOutput] || 1);
                let diluentVol_targetUnit = diluentVol_base / (volFactorsToML[v2UnitOrig] || 1); // Show diluent in V2's unit for clarity

                v1ValEl.value = calculatedValue.toPrecision(4);
                calculationStepsStr = `V<sub>1</sub> = (C<sub>2</sub> &times; V<sub>2</sub>) / C<sub>1</sub> = (${c2_val} ${c2_unit} &times; ${v2_val} ${v2_unit}) / ${c1_val} ${c1_unit}. <br>You need ${calculatedValue.toPrecision(4)} ${targetVolUnitForOutput} of stock.`;
                if (v2_base >= (calculatedValue * (volFactorsToML[targetVolUnitForOutput]||1) )) { // only show diluent if V2 is larger
                     calculationStepsStr += `<br>Add ${diluentVol_targetUnit.toPrecision(4)} ${v2UnitOrig} of diluent to reach final volume ${v2_val} ${v2UnitOrig}.`;
                } else {
                     calculationStepsStr += `<br>Note: Final volume V2 (${v2_val} ${v2_unit}) is less than required stock volume. Check inputs.`;
                }
                resultP.innerHTML = `Calculated Stock Volume (V<sub>1</sub>) = <strong>${calculatedValue.toPrecision(4)} ${targetVolUnitForOutput}</strong>`;
            } else if (isNaN(c2_base) && !isNaN(c1_base) && !isNaN(v1_base) && !isNaN(v2_base)) { // Calculate C2
                if (v2_base === 0) { resultP.textContent = "Error: V2 (Final Volume) cannot be zero."; resultP.className = "font-semibold text-red-600"; resultContainer.classList.remove('hidden'); return; }
                calculatedValue = (c1_base * v1_base) / v2_base;
                targetConcUnitForOutput = c2UnitOrig;
                if (concFactorsToMolar[targetConcUnitForOutput]) calculatedValue /= concFactorsToMolar[targetConcUnitForOutput];
                else if (concFactorsToGramsPerLiter[targetConcUnitForOutput]) calculatedValue /= concFactorsToGramsPerLiter[targetConcUnitForOutput];

                c2ValEl.value = calculatedValue.toPrecision(4);
                calculationStepsStr = `C<sub>2</sub> = (C<sub>1</sub> &times; V<sub>1</sub>) / V<sub>2</sub> = (${c1_val} ${c1_unit} &times; ${v1_val} ${v1_unit}) / ${v2_val} ${v2_unit}`;
                resultP.innerHTML = `Calculated Final Concentration (C<sub>2</sub>) = <strong>${calculatedValue.toPrecision(4)} ${targetConcUnitForOutput}</strong>`;
            } else if (isNaN(v2_base) && !isNaN(c1_base) && !isNaN(v1_base) && !isNaN(c2_base)) { // Calculate V2
                if (c2_base === 0) { resultP.textContent = "Error: C2 (Final Concentration) cannot be zero for this calculation unless C1 or V1 is also zero."; resultP.className = "font-semibold text-red-600"; resultContainer.classList.remove('hidden'); return;}
                calculatedValue = (c1_base * v1_base) / c2_base; // This is in mL
                targetVolUnitForOutput = v2UnitOrig;
                calculatedValue /= (volFactorsToML[targetVolUnitForOutput] || 1);

                v2ValEl.value = calculatedValue.toPrecision(4);
                calculationStepsStr = `V<sub>2</sub> = (C<sub>1</sub> &times; V<sub>1</sub>) / C<sub>2</sub> = (${c1_val} ${c1_unit} &times; ${v1_val} ${v1_unit}) / ${c2_val} ${c2_unit}`;
                resultP.innerHTML = `Calculated Final Volume (V<sub>2</sub>) = <strong>${calculatedValue.toPrecision(4)} ${targetVolUnitForOutput}</strong>`;
            } else {
                 resultP.textContent = "Error: Could not determine calculation path. Check inputs and units.";
                 resultP.className = "font-semibold text-red-600";
                 resultContainer.classList.remove('hidden');
                 return;
            }
            
            resultP.className = "font-semibold text-blue-700"; 
            stepsP.innerHTML = calculationStepsStr;
            resultContainer.classList.remove('hidden'); 
        }


        function calculateCellDensity() {
            const cellsCountedInput = document.getElementById('cells-counted');
            const dilutionFactorInput = document.getElementById('dilution-factor');
            const outputP = document.getElementById('cell-density-output');

            if(!cellsCountedInput || !dilutionFactorInput || !outputP) {
                // console.error("Cell density calculator elements missing.");
                return; 
            }

            const cellsCounted = parseInt(cellsCountedInput.value); 
            const dilutionFactor = parseFloat(dilutionFactorInput.value);

            if (isNaN(cellsCounted) || isNaN(dilutionFactor) || cellsCounted < 0 || dilutionFactor <= 0) {
                outputP.textContent = "Please enter valid, positive numbers for cells counted and dilution factor.";
                outputP.className = "mt-3 font-semibold text-red-600";
                return;
            }
            
            const avgCellsPerSquare = cellsCounted / 4; 
            const cellsPerMilliLiter = avgCellsPerSquare * dilutionFactor * 10000; 
            
            outputP.innerHTML = `Calculated Cell Density: <strong>${cellsPerMilliLiter.toExponential(2)} cells/mL</strong>`;
            outputP.className = "mt-3 font-semibold text-green-700";
        }

        function checkPracticeAnswer(problemId, correctAnswers, inputIds) {
            const feedbackDiv = document.getElementById(`${problemId}-feedback`);
            const solutionDiv = document.getElementById(`${problemId}-solution`);
            const inputElements = inputIds.map(id => document.getElementById(id));

            if (!feedbackDiv || !solutionDiv || inputElements.some(el => !el)) {
                // console.error(`Missing elements for practice problem ${problemId}`);
                return;
            }

            let allCorrect = true;
            inputElements.forEach((inputEl, index) => {
                const userAnswer = parseFloat(inputEl.value);
                inputEl.classList.remove('correct-answer', 'incorrect-answer'); 
                // Using a small tolerance for floating point comparisons
                if (isNaN(userAnswer) || Math.abs(userAnswer - correctAnswers[index]) > 0.011 * Math.abs(correctAnswers[index]) + 1e-5 ) { 
                    allCorrect = false;
                    inputEl.classList.add('incorrect-answer');
                } else {
                    inputEl.classList.add('correct-answer');
                }
            });

            feedbackDiv.classList.remove('hidden', 'text-green-600', 'text-red-600');
            solutionDiv.classList.remove('hidden'); 

            if (allCorrect) {
                feedbackDiv.textContent = 'Correct!';
                feedbackDiv.classList.add('text-green-600');
            } else {
                feedbackDiv.innerHTML = 'One or more answers are incorrect. Please review the solution below.';
                feedbackDiv.classList.add('text-red-600');
            }
        }

        // --- INITIALIZATION ---
        window.onload = () => {
            populateSidebar(); 
            if (welcomeMessage) { 
                welcomeMessage.style.display = 'block';
            }
            // Automatically load the first module or a specific module if desired
            // if (modulesData.length > 0) {
            //    loadModule(modulesData[0].id);
            // }
        };
    </script>
</body>
</html>
